import{transform as e}from"@swc/core";import t from"fs";import n from"path";import{fileURLToPath as r}from"url";import{createRequire as i}from"module";const a=`__atomic_generated`,o=RegExp(`/\\*\\s*${a}:([^*]+)\\s*\\*/`,`g`),s=i(import.meta.url).resolve;function c(){let t=new Set,r;return{name:`vite-plugin`,configResolved(e){r=e.cacheDir},async transform(i,c){if(!/\.(t|j)sx?$/.test(c))return null;let u=c.endsWith(`.ts`)||c.endsWith(`.tsx`),d=c.endsWith(`.tsx`),f=await e(i,{filename:c,swcrc:!1,sourceMaps:!1,configFile:!1,jsc:{parser:{syntax:u?`typescript`:`ecmascript`,tsx:d},target:`es2022`,experimental:{plugins:[[s(`@atomic-variants/swc-plugin`),{tag:a}]],cacheRoot:n.join(r??`node_modules/.vite`,`.swc`)}}});o.lastIndex=0;let p=o.exec(f.code);return p&&(t.add((p?.[1]||``).trim()),l(t)),{code:f.code,map:f.map}},buildEnd(){l(t)}}}const l=e=>{if(e.size>0){let i=n.dirname(r(import.meta.url));t.writeFileSync(n.resolve(i,`../atomic-variants.css`),`@source inline("${Array.from(e).join(` `)}");`)}};export{c as default};